{"metadata":{"guid":"44b78bb7-f42b-4fca-ae60-859b11f91b10","url":"/v2/streaming_pipelines/44b78bb7-f42b-4fca-ae60-859b11f91b10","created_at":"2018-03-22T20:42:43Z","updated_at":"2018-03-23T19:39:50Z","revision":1521833990027},"entity":{"name":"Cloudant to Db2 streams flow","description":"","project_guid":"66de3be1-eadf-47cb-b36c-b35e7009ed69","graph":{"doc_type":"pipeline","version":"1.0","json_schema":"http://www.ibm.com/ibm/wdp/flow-v1.0/pipeline-flow-v1-schema.json","id":"","app_data":{"ui_data":{"name":"Streams data flow example"}},"primary_pipeline":"primary-pipeline","pipelines":[{"id":"primary-pipeline","runtime":"streams","nodes":[{"id":"code_etw4bub2vtf","type":"binding","op":"ibm.streams.sources.code","outputs":[{"id":"target","schema_ref":"schema0","links":[{"node_id_ref":"dashdb_6srey7s6m8d","port_id_ref":"source"}]}],"parameters":{"code":"import sys\nfrom cloudant import Cloudant\nfrom cloudant.feed import Feed\n\n# init() function will be called once on pipeline initialization\n# @state a Python dictionary object for keeping state. The state object is passed to the produce function\n\n\ndef init(state):\n    # do something once on pipeline initialization and save in the state object\n    pass\n\n\n# produce() function will be called when the job starts to run.\n# It is called on a background thread, and it will typically invoke the 'submit()' callback\n# whenever a tuple of data is ready to be emitted from this operator.\n# This allows for using asynchronous data services as well as synchronous data generation or retrieval.\n# @submit a Python callback function that takes one argument: a dictionary representing a single tuple.\n# @state a Python dictionary object for keeping state\n# You must declare all output attributes in the Edit Schema window.\ndef produce(submit, state):\n    client = Cloudant(\n        'username',\n        'password',\n        account='account',\n        connect=True\n    )\n    db = client['animaldb']\n    feed = Feed(db, feed='continuous', include_docs=True)\n    for change in feed:\n        doc = change['doc']\n        if 'payload' in doc:\n            output_doc = {}\n            output_doc['_id'] = doc['_id']\n            output_doc['_rev'] = doc['_rev']\n            if 'wiki_page' in doc['payload']:\n                output_doc['wiki_page'] = doc['payload']['wiki_page']\n            if 'class' in doc['payload']:\n                output_doc['class'] = doc['payload']['class']\n            if 'diet' in doc['payload']:\n                output_doc['diet'] = doc['payload']['diet']\n            if 'min_weight' in doc['payload']:\n                output_doc['min_weight'] = doc['payload']['min_weight']\n            if 'max_weight' in doc['payload']:\n                output_doc['max_weight'] = doc['payload']['max_weight']\n            # Submit a tuple in each iteration:\n            submit(output_doc)","schema_mapping":[{"name":"diet","type":"string","length":0,"source_elem_name":"","target_elem_name":""},{"name":"class","type":"string","length":0,"source_elem_name":"","target_elem_name":""},{"name":"max_weight","type":"double","length":0,"source_elem_name":"","target_elem_name":""},{"name":"min_weight","type":"double","length":0,"source_elem_name":"","target_elem_name":""},{"name":"wiki_page","type":"string","length":0,"source_elem_name":"","target_elem_name":""},{"name":"rev","type":"string","length":0,"source_elem_name":"","target_elem_name":""},{"name":"id","type":"string","length":0,"source_elem_name":""}]},"app_data":{"ui_data":{"label":"Code","x_pos":-300,"y_pos":160}}},{"id":"dashdb_6srey7s6m8d","type":"binding","op":"ibm.streams.targets.dashdb","parameters":{"schema_mapping":[{"name":"diet","type":"string","length":0,"target_elem_name":"diet"},{"name":"class","type":"string","length":0,"target_elem_name":"class"},{"name":"max_weight","type":"double","length":0,"target_elem_name":"max_weight"},{"name":"min_weight","type":"double","length":0,"target_elem_name":"min_weight"},{"name":"wiki_page","type":"string","length":0,"target_elem_name":"wiki_page"},{"name":"rev","type":"string","length":0,"target_elem_name":"_rev"},{"name":"id","type":"string","length":0,"target_elem_name":"_id"}]},"connection":{"ref":"3d78dae5-ed9d-466a-ac3c-495f9f501982","project_ref":"66de3be1-eadf-47cb-b36c-b35e7009ed69","properties":{"asset":{"path":"/DASH5961/ANIMALS","asset_types":[],"assets":[],"fields":[{"name":"_id","type":{"type":"varchar","length":1024,"scale":0,"nullable":true,"signed":false}},{"name":"_rev","type":{"type":"varchar","length":1024,"scale":0,"nullable":true,"signed":false}},{"name":"_deleted","type":{"type":"boolean","length":1,"scale":0,"nullable":true,"signed":false}},{"name":"min_weight","type":{"type":"double","length":53,"scale":0,"nullable":true,"signed":true}},{"name":"max_weight","type":{"type":"double","length":53,"scale":0,"nullable":true,"signed":true}},{"name":"min_length","type":{"type":"double","length":53,"scale":0,"nullable":true,"signed":true}},{"name":"max_length","type":{"type":"double","length":53,"scale":0,"nullable":true,"signed":true}},{"name":"latin_name","type":{"type":"varchar","length":1024,"scale":0,"nullable":true,"signed":false}},{"name":"wiki_page","type":{"type":"varchar","length":1024,"scale":0,"nullable":true,"signed":false}},{"name":"class","type":{"type":"varchar","length":1024,"scale":0,"nullable":true,"signed":false}},{"name":"diet","type":{"type":"varchar","length":1024,"scale":0,"nullable":true,"signed":false}},{"name":"sortfield","type":{"type":"varchar","length":1024,"scale":0,"nullable":true,"signed":false}}],"extended_metadata":[],"first":{"href":"https://api.dataplatform.ibm.com/v2/connections/3d78dae5-ed9d-466a-ac3c-495f9f501982/assets?project_id=1439d84a-1904-414e-a167-3905def8b528&offset=0&limit=100&path=%2FDASH5961%2FANIMALS"},"total_count":1,"logs":[]}}},"app_data":{"ui_data":{"label":"Db2 Warehouse on Cloud","x_pos":-40,"y_pos":160}}}]}],"schemas":[{"id":"schema0","fields":[{"name":"diet","type":"string"},{"name":"class","type":"string"},{"name":"max_weight","type":"double"},{"name":"min_weight","type":"double"},{"name":"wiki_page","type":"string"},{"name":"rev","type":"string"},{"name":"id","type":"string"}]}]},"engines":{"streams":{"instance_id":"25033a58-aac5-4a0a-96b8-d14c1d229601"}}}}